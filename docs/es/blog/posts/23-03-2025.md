---
title: "Server-Site Request Forgery: La Puerta Trasera que Puede Derribar tu Infraestructura"
summary: ""
date: 2025-03-23
tags:
  - Ciberseguridad
  - Pentesting
  - SSRF
  - Seguridad Web
  - Vulnerabilidades
lang: es
---

# Server-Site Request Forgery: La Puerta Trasera que Puede Derribar tu Infraestructura

En el complejo panorama de la ciberseguridad actual, pocas vulnerabilidades son tan insidiosas y potencialmente devastadoras como el **Server-Side Request Forgery (SSRF)**. Esta técnica de ataque, a menudo subestimada, puede transformar un servidor aparentemente seguro en una puerta de entrada para los ciberdelincuentes, permitiéndoles acceder a recursos internos, robar datos sensibles e incluso lanzar ataques contra terceros.

¿El resultado? Robo de datos, acceso a servicios internos y, en casos extremos, ejecución remota de código.

## ¿Qué es el SSRF?
Los ataques de Server-Site Request Forgery (SSRF) ocurren cuando un atacante puede manipular un servidor para que realice solicitudes HTTP no autorizadas. Esto puede parecer inofensivo a primera vista, pero las implicaciones son profundas. Imagina que tu servidor, en el que confías plenamente, se convierte en un títere controlado por un atacante, capaz de acceder a sistemas internos, bases de datos y servicios que normalmente estarían fuera del alcance de cualquier usuario externo.

Por ejemplo, tenemos una aplicación de compras que permite a los usuarios ver si un producto tiene stock. Para ofrecer información del stock, la aplicación realiza consultas a varias API REST del back-end. Esto lo hace pasando la URL al endpoint de la API a través de una solicitud HTTP.

## Tipos de Server-Site Request Forgery
Existen tres tipos principales de ataques Server-Side Request Forgery (SSRF):

1. **SSRF estándar**: En este tipo de ataque, la respuesta del servidor se muestra directamente al atacante. El servidor obtiene la URL solicitada por el atacante y envía la respuesta de vuelta.
2. **SSRF ciego (Blind SSRF)**: En este caso, la respuesta no se envía de vuelta al atacante. El atacante debe idear formas de confirmar la vulnerabilidad sin ver directamente la respuesta del servidor.
3. **SSRF ciego basado en tiempo**: Una variante del SSRF ciego donde el atacante infiere información basándose en el tiempo que tarda el servidor en responder

A continuación, veremos las características y métodos de explotación propios de cada tipo de SSRF. Esto requiere diferentes enfoques para la detección y mitigación de estas vulnerabilidades.

### SSRF Estándar
El ataque de SSRF estándar es la forma más directa de realizar este ataque. En este escenario, el atacante puede observar directamente la respuesta del servidor a la solicitud manipulada. Esto permite al atacante recopilar información detallada sobre la red interna, identificar servicios accesibles y potencialmente recuperar datos sensibles
Tenemos una aplicación web permite a los usuarios verificar el stock de productos consultando una API interna.

### Metodología de explotación

La explotación de este tipo de SSRF se divide en 3 fases:
1. El atacante inyecta una URL maliciosa como parte de la entrada del usuario.
2. El servidor procesa la solicitud y realiza una petición al recurso especificado.
3. La respuesta se devuelve al atacante, revelando información sobre la red interna o los sistemas back-end.

Veamos un ejemplo, donde tenemos a una aplicación web que permite consultar el stock de los productos que oferta:

Mediante la herramienta Burpsuite, podemos ver la solicitud que se realiza al visualizar el stock de los productos:
```http
POST /product/stock HTTP/1.0
Content-Type: application/x-www-form-urlencoded
Content-Length: 118

stockApi=stockApi=http://internal-stock-api/check?productId=123
```
Esta solucitud hace que el cliente reciba el estado del stock de un producto indicado con el `productId`.

Sin embargo, el atacante podría modificar la petición a la URL que se especifica, como por ejemplo:
```HTTP
POST /product/stock HTTP/1.0
Content-Type: application/x-www-form-urlencoded
Content-Length: 118

stockApi=http://localhost/admin
```
Al modificar la solicitud, si el directorio `/admin` viene de una máquina local y esta solicitud se procesa sin la debida validación, se podría acceder al panel de administración local, exponiendo información sensible o funcionalidades restringidas.

### SSRF Ciego
El ataque SSRF ciego representa un desafío mayor para los atacantes, ya que no reciben directamente la respuesta del servidor, si no que en este tipo de ataque, los ciberdelincuentes deben inferir el éxito de su intrusión a través de cambios observables en el comportamiento de la aplicación.

### Metodología de explotación
Imaginemos una aplicación web que permite a los usuarios subir imágenes de perfil. La aplicación verifica que la imagen sea válida haciendo una solicitud a la URL proporcionada, pero no muestra el resultado de esta verificación al usuario.
```python
import requests

def verify_image(url):
  try:
    # Send an HTTP GET request to the provided URL with a timeout of 5 seconds
    response = requests.get(url, timeout=5)
    # Check if the response's content type starts with 'image/'
    if response.headers.get('content-type', '').startswith('image/'):
      return True
  except:
    # Handle any exceptions (e.g., timeout, invalid URL, etc.)
    pass
  # Return False if the URL is not valid or does not point to an image
  return False

# Example usage of the function
user_provided_url = "https://example.com/image.jpg"
if verify_image(user_provided_url):
  # Process the image if it is valid
  print("Valid image")
else:
  # Reject the image if it is invalid
  print("Rejected URL")

```
Como vemos, el servidor recibe una URL proporcionada por un usuario, en este caso es `https://example.com/image.jpg`, luego se realiza una solicitud HTTP a esa URL para verificar si contiene una imagen. Y finalmente si la URL proporcionada accede a un recurso, en este caso con el header **Content-Type: image/*** se dará como válida.

El problema reside en que el **servidor confía ciegamente** en las URLs que son proporcionaas por los usuarios, permitiendo así que se puedan realizar solicitudes *HTTP* arbitrárias.

Por tanto, si un atacante proporciona la siguiente URL: `http://internal-server/sensitive-data` el atacante no verá directamente la respuesta del servidor, pero podrá observar ciertos comportamientos para deducir si la solicitud fue exitosa o no:
- **Tiempo de respuesta**: Si el recurso interno tarda más en responder (por ejemplo, porque es un servicio pesado), esto podría indicar que el servidor accedió al recurso.
- **Mensajes de error**: Si el servidor devuelve errores diferentes dependiendo de si pudo acceder al recurso o no, esto puede ser explotado para confirmar la existencia del recurso.

Por ejemplo, si el recurso que accede el atacante no existe, la respuesta del servidor será menor en comparación a si el recurso existe.









### SSRF Ciego basado en tiempo

