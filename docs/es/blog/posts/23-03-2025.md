---
title: "Server-Side Request Forgery: La Puerta Trasera que Puede Derribar tu Infraestructura"
summary: "En el complejo panorama de la ciberseguridad actual, donde la seguridad de las aplicaciones web es crucial, pocas vulnerabilidades son tan insidiosas y potencialmente devastadoras como el **Server-Side Request Forgery (SSRF)**. Esta técnica de ataque, a menudo subestimada, puede transformar un servidor aparentemente seguro en una puerta de entrada para los ciberdelincuentes, permitiéndoles acceder a recursos internos, robar datos sensibles e incluso lanzar ataques contra terceros.\n\n¿El resultado? Robo de datos, acceso a servicios internos, ejecución remota de código y, en última instancia, daño a la reputación, multas por incumplimiento de normativas como GDPR, y pérdidas financieras significativas. Un ataque SSRF exitoso puede paralizar operaciones críticas y comprometer la confianza de los clientes."
date: 2025-03-23
tags:
  - Ciberseguridad
  - Pentesting
  - SSRF
  - Seguridad Web
  - Vulnerabilidades
lang: es
---

# Server-Side Request Forgery: La Puerta Trasera que Puede Derribar tu Infraestructura

En el complejo panorama de la ciberseguridad actual, donde la seguridad de las aplicaciones web es crucial, pocas vulnerabilidades son tan insidiosas y potencialmente devastadoras como el **Server-Side Request Forgery (SSRF)**. Esta técnica de ataque, a menudo subestimada, puede transformar un servidor aparentemente seguro en una puerta de entrada para los ciberdelincuentes, permitiéndoles acceder a recursos internos, robar datos sensibles e incluso lanzar ataques contra terceros.

¿El resultado? Robo de datos, acceso a servicios internos, ejecución remota de código y, en última instancia, daño a la reputación, multas por incumplimiento de normativas como GDPR, y pérdidas financieras significativas. Un ataque SSRF exitoso puede paralizar operaciones críticas y comprometer la confianza de los clientes.

<!-- more -->

## ¿Qué es el SSRF?

Los ataques de Server-Side Request Forgery (SSRF) ocurren cuando un atacante puede manipular un servidor para que realice solicitudes HTTP no autorizadas. Imagina que un servidor web es como un mensajero. Normalmente, solo entrega mensajes (solicitudes) a destinatarios autorizados. Un SSRF ocurre cuando un atacante engaña al servidor para que entregue mensajes a destinatarios no autorizados dentro de la red interna, como bases de datos o servidores de administración.

Por ejemplo, tenemos una aplicación de compras que permite a los usuarios ver si un producto tiene stock. Para ofrecer información del stock, la aplicación realiza consultas a varias API REST del back-end. Esto lo hace pasando la URL al endpoint de la API a través de una solicitud HTTP. Un atacante podría cambiar la URL a algo como `http://localhost/admin` para acceder a la interfaz de administración del servidor.

## Impacto de los ataques SSRF

Según [PortSwigger](https://portswigger.net/web-security/ssrf#what-is-the-impact-of-ssrf-attacks){:target="_blank"}, el impacto de los ataques SSRF pueden resultar en un acceso no autorizado a recursos internos del servidor. Además, en algunas situaciones, la vulnerabilidad SSRF podría permitir a un atacante la ejecución de comandos arbitrarios. Un exploit SSRF que cause conexiones a sistemas externos de terceros podría resultar en ataques maliciosos hacia adelante. Estos pueden parecer originados por la organización que aloja la aplicación vulnerable. Por ejemplo, un atacante podría usar un servidor vulnerable a SSRF para escanear puertos en la red interna de otra empresa, o incluso para lanzar un ataque DoS contra un servicio externo, haciendo que parezca que el ataque proviene de la organización que aloja la aplicación vulnerable.

## Tipos de Server-Side Request Forgery

Existen tres tipos principales de ataques Server-Side Request Forgery (SSRF):

- **SSRF estándar**: En este tipo de ataque, la respuesta del servidor se muestra directamente al atacante. El servidor obtiene la URL solicitada por el atacante y envía la respuesta de vuelta.
- **SSRF a ciegas (Blind SSRF)**: En este caso, la respuesta no se envía de vuelta al atacante. El atacante debe idear formas de confirmar la vulnerabilidad sin ver directamente la respuesta del servidor.
- **SSRF a ciegas basado en tiempo**: Una variante del SSRF ciego donde el atacante infiere información basándose en el tiempo que tarda el servidor en responder, son un tipo de ataque a un target muy concreto, por lo que en este post no nos centraremos en él.

A continuación, veremos las características y métodos de explotación propios de cada tipo de SSRF. Esto requiere diferentes enfoques para la detección y mitigación de estas vulnerabilidades.

### **SSRF Estándar**

El ataque de SSRF estándar es la forma más directa de realizar este ataque. En este escenario, el atacante puede observar directamente la respuesta del servidor a la solicitud manipulada. Esto permite al atacante recopilar información detallada sobre la red interna, identificar servicios accesibles y potencialmente recuperar datos sensibles. Un atacante podría usar este tipo de SSRF para leer archivos de configuración sensibles en el servidor (`file:///etc/passwd` en Linux).

Tenemos una aplicación web permite a los usuarios verificar el stock de productos consultando una API interna.

#### Metodología de explotación

La explotación de este tipo de SSRF se divide en 3 fases:

1.  **Inyección:** El atacante introduce una URL maliciosa en un campo de entrada de la aplicación.
2.  **Solicitud:** El servidor, sin validar la URL, realiza una solicitud al recurso especificado por el atacante.
3.  **Revelación:** La respuesta del servidor se devuelve al atacante, permitiéndole acceder a información interna o realizar acciones no autorizadas.

Veamos un ejemplo, donde tenemos a una aplicación web que permite consultar el stock de los productos que oferta:

Mediante la herramienta Burpsuite, podemos ver la solicitud que se realiza al visualizar el stock de los productos:

```http
POST /product/stock HTTP/1.0
Content-Type: application/x-www-form-urlencoded
Content-Length: 118

stockApi=stockApi=http://internal-stock-api/check?productId=123
```

Esta solicitud hace que el cliente reciba el estado del stock de un producto indicado con el `productId`.

Sin embargo, el atacante podría modificar la petición a la URL que se especifica, como por ejemplo:

```http
POST /product/stock HTTP/1.0
Content-Type: application/x-www-form-urlencoded
Content-Length: 118

stockApi=http://localhost/admin
```

Al modificar la solicitud, si el directorio `/admin` viene de una máquina local y esta solicitud se procesa sin la debida validación, se podría acceder al panel de administración local, exponiendo información sensible o funcionalidades restringidas. Este tipo de ataque se denomina '_ataque SSRF en contra el servidor_'.

**Posible Respuesta (si el acceso es exitoso):**

```http
HTTP/1.1 200 OK
Content-Type: text/plain

admin:password123
user1:password456
```

### **SSRF a ciegas**

El ataque SSRF ciego representa un desafío mayor para los atacantes, ya que no reciben directamente la respuesta del servidor, si no que en este tipo de ataque, los ciberdelincuentes deben inferir el éxito de su intrusión a través de cambios observables en el comportamiento de la aplicación. Un atacante podría usar este tipo de SSRF para activar funciones internas que normalmente no están expuestas al público.

#### Metodología de explotación

Imaginemos una aplicación web que permite a los usuarios subir imágenes de perfil. La aplicación verifica que la imagen sea válida haciendo una solicitud a la URL proporcionada, pero no muestra el resultado de esta verificación al usuario.

```python
import requests

def verify_image(url):
  try:
    # Send an HTTP GET request to the provided URL with a timeout of 5 seconds
    response = requests.get(url, timeout=5)
    # Check if the response's content type starts with 'image/'
    if response.headers.get('content-type', '').startswith('image/'):
      return True
  except:
    # Handle any exceptions (e.g., timeout, invalid URL, etc.)
    pass
    # Return False if the URL is not valid or does not point to an image
    return False

  # Example usage of the function
  user_provided_url = "https://example.com/image.jpg"
  if verify_image(user_provided_url):
  # Process the image if it is valid
    print("Valid image")
  else:
    # Reject the image if it is invalid
    print("Rejected URL")
```

Como vemos, el servidor recibe una URL proporcionada por un usuario, en este caso es `https://example.com/image.jpg`, luego se realiza una solicitud HTTP a esa URL para verificar si contiene una imagen. Y finalmente si la URL proporcionada accede a un recurso, en este caso con el header **Content-Type: image/\*** se dará como válida.

El problema reside en que el **servidor confía ciegamente** en las URLs que son proporcionadas por los usuarios, permitiendo así que se puedan realizar solicitudes _HTTP_ arbitrarias.

Por tanto, si un atacante proporciona una URL la cual esté controlada por él mismo o que simplemente apunte a un recurso interno del propio servidor, por ejemplo `http://internal-server/sensitive-data`, el atacante no verá directamente la respuesta del servidor, pero podrá observar ciertos comportamientos para deducir si la solicitud fue exitosa o no:

- **Tiempo de respuesta**: Si el recurso interno tarda más en responder (por ejemplo, porque es un servicio pesado), esto podría indicar que el servidor accedió al recurso.
- **Mensajes de error**: Si el servidor devuelve errores diferentes dependiendo de si pudo acceder al recurso o no, esto puede ser explotado para confirmar la existencia del recurso.

Por ejemplo, si el recurso que accede el atacante no existe, la respuesta del servidor será menor en comparación a si el recurso existe.

Para poder verificar si la solicitud que ha realizado el atacante desde el servidor hacia su objetivo es correcta se hace uso de técnicas de **fuera de banda (OOB)**, por ejemplo:
`http://internal-server.sensitive-data.attacker-domain.com`. Como podemos ver en esta URL maliciosa, `attacker-domain` es un dominio controlado por el atacante, por tanto, el servidor vulnerable intentará resolver este dominio malicioso y realizar una solicitud HTTP hacia él. Debido a esto, el atacante puede monitorear el propio servidor DNS o web para confirmar que la solicitud fue realizada. Un atacante puede usar un dominio que controla (por ejemplo, `attacker.com`) y configurar registros DNS para registrar todas las consultas DNS que se hacen a ese dominio. Luego, inyecta una URL como `http://unique-id.attacker.com`. Si el servidor vulnerable intenta resolver este dominio, el atacante verá una entrada en sus registros DNS, confirmando la vulnerabilidad. 
Además, se pueden usar servicios como [Canarytokens](https://canarytokens.org/generate){:target="_blank"} para generar tokens únicos que alertan cuando se acceden.

## Como prevenir los ataques SSRF

Como hemos visto anteriormente, este tipo de ataques son particularmente peligrosos facilitando la explotación de recursos internos o externos de un servidor. Para protegerse contra este tipo de vulnerabilidad, es fundamental implementar una combinación de medidas de seguridad robustas. A continuación, se detallan las estrategias más efectivas:

### **Validar estrictamente la entrada**

Para protegernos ante un ataque estándar de SSRF, podemos hacer uso de:

- **Whitelists**: Podemos permitir que el servidor acceda a URLs específicas y que sean confiables para el correcto uso de la aplicación. En lugar de permitir cualquier URL, define una lista blanca de dominios y rutas a las que el servidor puede acceder. Cualquier solicitud que no coincida con esta lista blanca debe ser rechazada. Ejemplo: `permitidos = ["api.ejemplo.com/productos", "imagenes.ejemplo.com"]`.
- **Bloqueo de direcciones internas**: Podemos bloquear solicitudes a URLs internas, con el fin de que no se puedan acceder a recursos internos del servidor (`localhost` o cualquier IP del estilo `192.168.x.x`). Configura el servidor para rechazar cualquier solicitud a direcciones IP privadas (10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16) y a `localhost` (127.0.0.1).
- **Restringir protocolos**: Podemos bloquear protocolos como **ftp://**, **file://**, entre otros.

### **Uso de Web Application Firewalls (WAFs)**

Podemos configurar un WAF con reglas específicas puede ayudar a detectar y bloquear patrones sospechosos relacionados con SSRF. Los WAFs pueden actuar como una capa adicional de defensa al monitorear y filtrar el tráfico saliente del servidor. Ejemplos de reglas WAF:

- Bloquear cualquier solicitud que contenga `127.0.0.1` o `localhost` en la URL.
- Bloquear solicitudes que usen protocolos como `file://`, `ftp://`, `gopher://`.
- Bloquear solicitudes a direcciones IP privadas.

### **Actualizaciones y Parches**

Asegúrate de que todos los componentes del servidor (sistema operativo, servidor web, frameworks, librerías) estén actualizados con los últimos parches de seguridad. Las actualizaciones a menudo corrigen vulnerabilidades SSRF conocidas.

### **Segmentación de Red**

Divide la red en segmentos y limita el acceso entre ellos. Por ejemplo, el servidor web no debería tener acceso directo a la base de datos. En su lugar, debería comunicarse a través de un servicio intermediario con permisos limitados.

### **Pruebas periódicas de seguridad**

Realiza pruebas regulares para identificar posibles vulnerabilidades SSRF en tu aplicación antes de que puedan ser explotadas:

- Analiza todas las entradas que puedan generar solicitudes HTTP.
- Prueba con diferentes tipos de URLs (internas, externas, maliciosas) para identificar puntos débiles.

### **Uso de técnicas fuera de banda (OOB)**

Aunque el SSRF ciego no muestra respuestas directamente al atacante, las técnicas fuera de banda pueden ayudar a detectar intentos maliciosos:

- Configura herramientas como un DNS controlado para identificar solicitudes inesperadas hacia dominios externos.
- Supervisa interacciones con servidores externos controlados por el atacante.

## Conclusión

La prevención de ataques SSRF requiere un enfoque de seguridad en capas, combinando validación de entrada, uso de WAFs, actualizaciones regulares, segmentación de red y pruebas de seguridad. Al implementar estas medidas, puedes reducir significativamente el riesgo de que tu infraestructura sea comprometida por esta peligrosa vulnerabilidad. Recuerda que la seguridad es un proceso continuo, y es importante mantenerse actualizado sobre las últimas vulnerabilidades y técnicas de ataque.

**Descargo de Responsabilidad:** La información proporcionada en este documento se ofrece con fines educativos. No debe utilizarse para actividades ilegales o no autorizadas.

---